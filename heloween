-- Halloween loading screen (optimized) — 4 minutes (240 sec)
local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = game:GetService("CoreGui")

local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.fromRGB(20, 5, 20)
bg.BorderSizePixel = 0
bg.Parent = gui

-- Частицы (оптимизировано)
for i = 1, 40 do
	local spark = Instance.new("Frame")
	spark.Size = UDim2.new(0, 2, 0, 2)
	spark.Position = UDim2.new(math.random(), 0, math.random(), 0)
	spark.BackgroundColor3 = Color3.fromRGB(255, math.random(100,180), 0)
	spark.BorderSizePixel = 0
	spark.ZIndex = 1
	spark.Parent = bg

	task.spawn(function()
		while gui and gui.Parent do
			local nx, ny = math.random(), math.random()
			pcall(function()
				spark:TweenPosition(UDim2.new(nx, 0, ny, 0), "Out", "Sine", 5, true)
			end)
			task.wait(5)
		end
	end)
end

-- Небольшие "огненные кометы"
for i = 1, 3 do
	task.spawn(function()
		while gui and gui.Parent do
			local flame = Instance.new("Frame")
			flame.Size = UDim2.new(0, 3, 0, 16)
			flame.BackgroundColor3 = Color3.fromRGB(255, math.random(120,180), 0)
			flame.BorderSizePixel = 0
			flame.ZIndex = 2
			flame.Position = UDim2.new(math.random(), 0, -0.12, 0)
			flame.Rotation = math.random(-30,30)
			flame.Parent = bg

			pcall(function()
				flame:TweenPosition(UDim2.new(math.random(), 0, 1.2, 0), "Out", "Linear", 3, true)
			end)
			task.wait(3.1)
			if flame and flame.Parent then
				flame:Destroy()
			end
			task.wait(math.random(6, 12))
		end
	end)
end

-- Название
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 60)
title.Position = UDim2.new(0, 0, 0.05, 0)
title.Text = "Loading script..."
title.TextColor3 = Color3.fromRGB(255, 140, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.Arcade
title.TextSize = 40
title.ZIndex = 10
title.Parent = bg

task.spawn(function()
	local base, dots = "Loading script", 0
	while gui and gui.Parent do
		dots = (dots % 3) + 1
		pcall(function() title.Text = base .. string.rep(".", dots) end)
		task.wait(0.7)
	end
end)

-- Прогресс бар
local barBg = Instance.new("Frame")
barBg.Size = UDim2.new(0.8, 0, 0, 34)
barBg.Position = UDim2.new(0.1, 0, 0.75, 0)
barBg.BackgroundColor3 = Color3.fromRGB(50, 20, 0)
barBg.BorderSizePixel = 0
barBg.ZIndex = 5
barBg.Parent = bg

local bar = Instance.new("Frame")
bar.Size = UDim2.new(0, 0, 1, 0)
bar.BackgroundColor3 = Color3.fromRGB(255, 120, 0)
bar.BorderSizePixel = 0
bar.ZIndex = 6
bar.Parent = barBg

local percentText = Instance.new("TextLabel")
percentText.Size = UDim2.new(1, 0, 1, 0)
percentText.Text = "0%"
percentText.BackgroundTransparency = 1
percentText.TextColor3 = Color3.new(1, 1, 1)
percentText.Font = Enum.Font.Arcade
percentText.TextSize = 20
percentText.ZIndex = 7
percentText.Parent = barBg

-- Загрузка 4 минуты (240 сек) + плавное скрытие
task.spawn(function()
	local totalTime = 240
	for i = 0, totalTime do
		local percent = math.floor((i / totalTime) * 100)
		pcall(function()
			bar:TweenSize(UDim2.new(i / totalTime, 0, 1, 0), "Out", "Sine", 0.6, true)
			percentText.Text = percent .. "%"
		end)
		task.wait(1)
	end

	-- Плавное исчезновение
	for t = 0, 1, 0.04 do
		local inv = t
		pcall(function()
			bg.BackgroundTransparency = inv
			title.TextTransparency = inv
			percentText.TextTransparency = inv
			for _, v in pairs(bg:GetDescendants()) do
				if v:IsA("GuiObject") then
					-- меняем фоновую прозрачность только у элементов (не у всего текста постоянно)
					if v ~= title and v ~= percentText and v ~= bar and v ~= barBg then
						v.BackgroundTransparency = inv
					end
					if v:IsA("TextLabel") then
						v.TextTransparency = inv
					end
				end
			end
		end)
		task.wait(0.05)
	end

	pcall(function() if gui and gui.Parent then gui:Destroy() end end)
end)
